# Выполнил лабораторную работу студент группы 6233-010402D Гудков Сергей

## Apache NiFi

От Apache NiFi остались исключительно негативные ощущения. От проблем с получением файлов и выполнением фильтрации через SQL запрос, до постоянных вылетов (ноут перенагружался и nifi просто вставал) в момент исполнения пайплайна, хотя выделено было 4г оперативки (больше выделить не мог, докер тогда вообще не запускается). Даже сейчас, пока пишу этот текст - он снова встал и не хочет перезагружаться (открываться пользовательский интерфейс), хотя никакими задачами он сейчас не занят, нужно снова перезапускать контейнер, хотя запущен он один... 

### Пайплайн

1. **GetFile**
   - **Описание**: Читает файлы из указанной директории.
   - **Конфигурация**: Указана директория с файлами и паттерн для поиска файлов.

2. **UpdateAttribute**
   - **Описание**: Переименовывает имя файла, чтобы в результате образовался один итоговый файл вместо множества отдельных файлов.
   - **Конфигурация**: Добавлен новый шаблон для имени файла.

3. **SplitRecord**
   - **Описание**: Разделяет файл на строки, обеспечивая возможность дальнейшей построчной обработки.

4. **QueryRecord**
   - **Описание**: Выполняет фильтрацию строк, отбирая только те, в которых заполнены нужные атрибуты.
   - **SQL-запрос**: `SELECT * FROM FLOWFILE WHERE designation IS NOT NULL AND region_1 IS NOT NULL`

5. **UpdateRecord**
   - **Описание**: Заменяет все `null` значения в поле `price` на `0.0`.
   - **Конфигурация**: Добавлен параметр `/price` со значением `${field.value:replaceNull(0.0)}`.

6. **MergeRecord** (два этапа)
   - **Первый этап**: 
     - **Описание**: Объединяет строки в блоки по 1000–5000 записей, чтобы избежать переполнения очередей и ускорить обработку.
     - **Причина**: Большое количество строк приводило к переполнению очередей при попытке объединения всего файла за один этап.
   - **Второй этап**: 
     - **Описание**: Объединяет блоки, созданные на первом этапе, в один большой файл.

7. **PutFile**
   - **Описание**: Сохраняет итоговый файл на диск в заданной директории.

8. **PutElasticsearchHttpRecord**
   - **Описание**: Отправляет обработанные записи в Elasticsearch.
   - **Особенность**: Для избежания ошибок валидации вместо `PutElasticsearchHttp` использован `PutElasticsearchHttpRecord`, что позволило избежать конвертации формата.
  
   - 


